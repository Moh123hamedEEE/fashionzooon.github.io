<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fashion Zone | Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root { --gold: #d4af37; --dark: #1a1a1a; --white: #ffffff; --gray: #f4f4f4; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--gray); margin: 0; color: var(--dark); }
        .container { max-width: 500px; margin: 30px auto; background: var(--white); padding: 30px; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); border-top: 5px solid var(--gold); }
        .hidden { display: none !important; }
        input, button { width: 100%; padding: 14px; margin: 10px 0; border: 1px solid #ddd; border-radius: 12px; font-size: 16px; box-sizing: border-box; }
        button { background: var(--dark); color: white; border: none; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { background: var(--gold); color: var(--dark); }
        .google-btn { background: white; color: #444; border: 1px solid #ddd; display: flex; align-items: center; justify-content: center; gap: 10px; }
        nav { display: flex; justify-content: space-around; background: #eee; padding: 8px; border-radius: 12px; margin-bottom: 25px; }
        nav span { cursor: pointer; padding: 8px 15px; border-radius: 8px; font-weight: bold; font-size: 14px; }
        nav span.active { background: var(--gold); color: var(--dark); }
        .order-card { background: #fff; border: 1px solid #eee; border-right: 5px solid var(--gold); padding: 15px; border-radius: 12px; margin-bottom: 15px; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="text-align:center">FASHION ZONE</h2>
    
    <nav id="main-nav" class="hidden">
        <span id="tab-user" class="active" onclick="showTab('user')">Ø·Ù„Ø¨ Ø£ÙˆØ±Ø¯Ø±</span>
        <span id="tab-admin" class="hidden" onclick="showTab('admin')">Ø§Ù„Ù…Ø¯ÙŠØ± ğŸ”’</span>
        <span onclick="logout()" style="color: #d63031;">Ø®Ø±ÙˆØ¬</span>
    </nav>

    <div id="auth-section">
        <h3 id="auth-title" style="text-align:center">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
        <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
        <input type="password" id="pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        
        <div id="extra-fields" class="hidden">
            <input type="text" id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
            <input type="text" id="address" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø´Ø­Ù†">
        </div>

        <button id="btn-login" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
        <button id="btn-signup" class="hidden" onclick="signUp()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
        <button class="google-btn" onclick="loginWithGoogle()">
            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18"> Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¬ÙˆØ¬Ù„
        </button>

        <p id="toggle-text" onclick="toggleAuth()" style="text-align:center; cursor:pointer; color:blue; font-size:14px;">Ø¬Ø¯ÙŠØ¯ØŸ Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨</p>
        <p onclick="resetPasswordRequest()" style="text-align:center; cursor:pointer; color:gray; font-size:12px;">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</p>
    </div>

    <div id="user-section" class="hidden">
        <input type="text" id="order-items" placeholder="Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø£Ù† ØªØ·Ù„Ø¨ØŸ">
        <input type="text" id="order-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
        <input type="text" id="order-address" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„">
        <hr>
        <input type="text" id="trx-id" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (Trx ID)">
        <button onclick="submitOrder()">ØªØ£ÙƒÙŠØ¯ ÙˆØ·Ù„Ø¨ Ø§Ù„Ø¢Ù†</button>
    </div>

    <div id="admin-section" class="hidden">
        <h3>Ø§Ù„Ø£ÙˆØ±Ø¯Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©</h3>
        <div id="orders-list">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAaHWMwRlbZmbcJwQ1EXk0B9Yqt4VZ00cQ", 
        authDomain: "fashion-zooon.firebaseapp.com",
        databaseURL: "https://fashion-zooon-default-rtdb.firebaseio.com",
        projectId: "fashion-zooon",
    };
    const ADMIN_EMAIL = "your-email@gmail.com"; // ğŸ‘ˆ Ø¶Ø¹ Ø¥ÙŠÙ…ÙŠÙ„Ùƒ Ù‡Ù†Ø§

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const rtdb = firebase.database();

    function toggleAuth() {
        const isLogin = !document.getElementById('btn-login').classList.contains('hidden');
        document.getElementById('extra-fields').classList.toggle('hidden');
        document.getElementById('btn-login').classList.toggle('hidden');
        document.getElementById('btn-signup').classList.toggle('hidden');
        document.getElementById('auth-title').innerText = isLogin ? "Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯" : "ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„";
    }

    function showTab(tab) {
        document.getElementById('user-section').classList.toggle('hidden', tab !== 'user');
        document.getElementById('admin-section').classList.toggle('hidden', tab !== 'admin');
        document.getElementById('tab-user').classList.toggle('active', tab === 'user');
        document.getElementById('tab-admin').classList.toggle('active', tab === 'admin');
        if(tab === 'admin') loadOrders();
    }

    async function loginWithGoogle() {
        try {
            const result = await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
            const userDoc = await db.collection("Users").doc(result.user.uid).get();
            if (!userDoc.exists) {
                const { value: formValues } = await Swal.fire({
                    title: 'Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©',
                    html: '<input id="swal-input1" class="swal2-input" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„"><input id="swal-input2" class="swal2-input" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø´Ø­Ù†">',
                    focusConfirm: false,
                    preConfirm: () => [document.getElementById('swal-input1').value, document.getElementById('swal-input2').value]
                });
                await db.collection("Users").doc(result.user.uid).set({ phone: formValues[0], address: formValues[1], email: result.user.email });
            }
            location.reload();
        } catch (e) { Swal.fire('Ø®Ø·Ø£', e.message, 'error'); }
    }

    function signUp() {
        auth.createUserWithEmailAndPassword(document.getElementById('email').value, document.getElementById('pass').value).then(res => {
            db.collection("Users").doc(res.user.uid).set({ phone: document.getElementById('phone').value, address: document.getElementById('address').value, email: res.user.email });
            Swal.fire('Ù†Ø¬Ø§Ø­', 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨', 'success');
        }).catch(err => Swal.fire('Ø®Ø·Ø£', err.message, 'error'));
    }

    function login() {
        auth.signInWithEmailAndPassword(document.getElementById('email').value, document.getElementById('pass').value).catch(err => Swal.fire('Ø®Ø·Ø£', 'Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error'));
    }

    function resetPasswordRequest() {
        const email = document.getElementById('email').value;
        if(!email) return Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ø§ÙƒØªØ¨ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'warning');
        auth.sendPasswordResetEmail(email).then(() => Swal.fire('ØªÙ…', 'ØªÙÙ‚Ø¯ Ø¥ÙŠÙ…ÙŠÙ„Ùƒ Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯', 'info'));
    }

    function logout() { auth.signOut().then(() => location.reload()); }

    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('auth-section').classList.add('hidden');
            document.getElementById('main-nav').classList.remove('hidden');
            document.getElementById('user-section').classList.remove('hidden');
            if(user.email === ADMIN_EMAIL) document.getElementById('tab-admin').classList.remove('hidden');
            db.collection("Users").doc(user.uid).get().then(doc => {
                if(doc.exists()){
                    document.getElementById('order-phone').value = doc.data().phone;
                    document.getElementById('order-address').value = doc.data().address;
                }
            });
        }
    });

    async function submitOrder() {
        const trx = document.getElementById('trx-id').value;
        const ref = rtdb.ref('' + trx);
        const snap = await ref.once('value');
        if(snap.exists() && snap.val() === "verified") {
            await db.collection("Orders").add({
                email: auth.currentUser.email,
                items: document.getElementById('order-items').value,
                phone: document.getElementById('order-phone').value,
                address: document.getElementById('order-address').value,
                trx: trx,
                date: new Date().toLocaleString()
            });
            await ref.set("used"); // Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
            Swal.fire('Ù…Ù…ØªØ§Ø²!', 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø£ÙˆØ±Ø¯Ø± Ø¨Ù†Ø¬Ø§Ø­', 'success');
        } else { Swal.fire('ÙØ´Ù„', 'Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹', 'error'); }
    }

    function loadOrders() {
        const list = document.getElementById('orders-list');
        db.collection("Orders").orderBy("date", "desc").onSnapshot(snap => {
            list.innerHTML = "";
            snap.forEach(doc => {
                const o = doc.data();
                list.innerHTML += `<div class="order-card"><b>ğŸ’° ÙƒÙˆØ¯: ${o.trx}</b><br>ğŸ›ï¸ ${o.items}<br>ğŸ“ ${o.phone}<br><small>${o.date}</small></div>`;
            });
        });
    }
</script>
</body>
</html>
