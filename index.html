<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fashion Zone | Pro System</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        :root { --main: #2d3436; --accent: #00b894; --danger: #d63031; --bg: #f0f2f5; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        .container { max-width: 550px; margin: 30px auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .hidden { display: none !important; }
        input, button { width: 100%; padding: 14px; margin: 10px 0; border: 1px solid #ddd; border-radius: 12px; box-sizing: border-box; font-size: 16px; }
        button { background: var(--accent); color: white; border: none; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { opacity: 0.85; transform: translateY(-1px); }
        nav { display: flex; justify-content: space-around; margin-bottom: 25px; background: #eee; padding: 8px; border-radius: 12px; }
        nav span { cursor: pointer; color: #555; padding: 8px 15px; border-radius: 8px; transition: 0.2s; }
        nav span.active { background: white; color: var(--accent); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .order-card { border-right: 5px solid var(--accent); padding: 15px; border-radius: 12px; margin-bottom: 15px; background: #fff; border: 1px solid #eee; }
        .status { font-size: 12px; padding: 3px 8px; border-radius: 5px; background: #e8f5e9; color: #2e7d32; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="text-align: center; color: var(--main);">Fashion Zone ğŸ‘•</h2>
    
    <nav id="main-nav" class="hidden">
        <span id="tab-user" class="active" onclick="showTab('user')">Ø·Ù„Ø¨ Ø£ÙˆØ±Ø¯Ø±</span>
        <span id="tab-admin" class="hidden" onclick="showTab('admin')">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ ğŸ”’</span>
        <span onclick="logout()" style="color: var(--danger);">Ø®Ø±ÙˆØ¬</span>
    </nav>

    <div id="auth-section">
        <h3 id="auth-title">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</h3>
        <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
        <input type="password" id="pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        
        <div id="extra-fields" class="hidden">
            <input type="text" id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ (Ø£Ø³Ø§Ø³ÙŠ)">
            <input type="text" id="address" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø´Ø­Ù† (Ø£Ø³Ø§Ø³ÙŠ)">
        </div>

        <button id="btn-login" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
        <button id="btn-signup" class="hidden" onclick="signUp()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
        
        <p id="toggle-text" onclick="toggleAuth()" style="cursor:pointer; color: #0984e3; text-align: center; font-size: 14px; margin-top: 15px;">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†</p>
    </div>

    <div id="user-section" class="hidden">
        <p style="font-size: 14px; color: #666; text-align: center;">Ù…Ø±Ø­Ø¨Ø§Ù‹! ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ ÙÙ‚Ø· Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª.</p>
        <input type="text" id="order-items" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ / Ø§Ù„Ù„ÙˆÙ† / Ø§Ù„Ù…Ù‚Ø§Ø³">
        <input type="text" id="order-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø£ÙˆØ±Ø¯Ø±">
        <input type="text" id="order-address" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø´Ø­Ù† Ù„Ù‡Ø°Ø§ Ø§Ù„Ø£ÙˆØ±Ø¯Ø±">
        <hr>
        <p style="font-weight: bold;">ØªØ£ÙƒÙŠØ¯ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© (Firebase):</p>
        <input type="text" id="trx-id" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¸Ø§Ù‡Ø± ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ù„Ø©">
        <button onclick="submitOrder()">ØªØ£ÙƒÙŠØ¯ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
    </div>

    <div id="admin-section" class="hidden">
        <h3 style="color: var(--danger);">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ± ğŸ”’</h3>
        <div id="orders-list">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø£ÙˆØ±Ø¯Ø±Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡...</div>
    </div>
</div>

<script>
    // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙØ§ÙŠØ±Ø¨ÙŠØ³ (ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¶Ø¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù‡Ù†Ø§) ---
    const firebaseConfig = {
        apiKey: "AIzaSyAaHWMwRlbZmbcJwQ1EXk0B9Yqt4VZ00cQ", 
        databaseURL: "https://fashion-zooon-default-rtdb.firebaseio.com",
        projectId: "fashion-zooon",
        authDomain: "fashion-zooon.firebaseapp.com"
    };

    // --- Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ù…Ø¯ÙŠØ± ---
    const ADMIN_EMAIL = "ham123mada2010@gmail.com"; // ğŸ‘ˆ ØºÙŠØ± Ù‡Ø°Ø§ Ù„Ø¥ÙŠÙ…ÙŠÙ„Ùƒ

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const rtdb = firebase.database();

    function toggleAuth() {
        const isLogin = !document.getElementById('btn-login').classList.contains('hidden');
        document.getElementById('extra-fields').classList.toggle('hidden');
        document.getElementById('btn-login').classList.toggle('hidden');
        document.getElementById('btn-signup').classList.toggle('hidden');
        document.getElementById('auth-title').innerText = isLogin ? "Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯" : "ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„";
        document.getElementById('toggle-text').innerText = isLogin ? "Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„" : "Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†";
    }

    function showTab(tab) {
        document.getElementById('user-section').classList.toggle('hidden', tab !== 'user');
        document.getElementById('admin-section').classList.toggle('hidden', tab !== 'admin');
        document.getElementById('tab-user').classList.toggle('active', tab === 'user');
        document.getElementById('tab-admin').classList.toggle('active', tab === 'admin');
        if(tab === 'admin') loadOrders();
    }

    // --- ØªØ³Ø¬ÙŠÙ„ ÙˆØ­Ø³Ø§Ø¨ ---
    function signUp() {
        const email = document.getElementById('email').value;
        const pass = document.getElementById('pass').value;
        auth.createUserWithEmailAndPassword(email, pass).then(res => {
            db.collection("Users").doc(res.user.uid).set({
                phone: document.getElementById('phone').value,
                address: document.getElementById('address').value
            });
            alert("ØªÙ… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ù†Ø¬Ø§Ø­!");
        }).catch(err => alert(err.message));
    }

    function login() {
        const email = document.getElementById('email').value;
        const pass = document.getElementById('pass').value;
        auth.signInWithEmailAndPassword(email, pass).catch(err => alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©"));
    }

    function logout() { auth.signOut().then(() => location.reload()); }

    // --- Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ---
    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('auth-section').classList.add('hidden');
            document.getElementById('main-nav').classList.remove('hidden');
            document.getElementById('user-section').classList.remove('hidden');
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± Ù„Ù„Ù…Ø¯ÙŠØ± ÙÙ‚Ø·
            if(user.email === ADMIN_EMAIL) {
                document.getElementById('tab-admin').classList.remove('hidden');
            }

            db.collection("Users").doc(user.uid).get().then(doc => {
                if(doc.exists()){
                    document.getElementById('order-phone').value = doc.data().phone;
                    document.getElementById('order-address').value = doc.data().address;
                }
            });
        }
    });

    // --- Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ÙˆÙ…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø± ---
    async function submitOrder() {
        const trxId = document.getElementById('trx-id').value;
        if(!trxId) return alert("Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ©!");

        const ref = rtdb.ref('' + trxId);
        const snap = await ref.once('value');

        if(snap.exists() && snap.val() === "verified") {
            // 1. Ø­ÙØ¸ ÙÙŠ Firestore
            await db.collection("Orders").add({
                email: auth.currentUser.email,
                items: document.getElementById('order-items').value,
                phone: document.getElementById('order-phone').value,
                address: document.getElementById('order-address').value,
                trx: trxId,
                date: new Date().toLocaleString()
            });

            // 2. ØªØ¯Ù…ÙŠØ± Ø§Ù„Ø±Ù‚Ù… (Ù…Ù†Ø¹ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©)
            await ref.set("used");

            alert("âœ… ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø£ÙˆØ±Ø¯Ø±! Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ.");
            document.getElementById('trx-id').value = "";
        } else if(snap.val() === "used") {
            alert("âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù…Ø³Ø¨Ù‚Ø§Ù‹!");
        } else {
            alert("âŒ Ø±Ù‚Ù… ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ Ù„Ù… ÙŠØµÙ„ Ø§Ù„Ø³ÙŠØ³ØªÙ… Ø¨Ø¹Ø¯.");
        }
    }

    // --- Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ ---
    function loadOrders() {
        const list = document.getElementById('orders-list');
        db.collection("Orders").orderBy("date", "desc").onSnapshot(snap => {
            list.innerHTML = "";
            snap.forEach(doc => {
                const o = doc.data();
                list.innerHTML += `
                <div class="order-card">
                    <div style="display:flex; justify-content:space-between">
                        <b>ğŸ’° ÙƒÙˆØ¯: ${o.trx}</b>
                        <span class="status">Ø¬Ø¯ÙŠØ¯</span>
                    </div>
                    <p>ğŸ›ï¸ <b>Ø§Ù„Ù…Ù†ØªØ¬:</b> ${o.items}</p>
                    <p>ğŸ‘¤ <b>Ø§Ù„Ø¹Ù…ÙŠÙ„:</b> ${o.email}</p>
                    <p>ğŸ“ <b>ØªÙˆØ§ØµÙ„:</b> ${o.phone} | ğŸ“ <b>Ø¹Ù†ÙˆØ§Ù†:</b> ${o.address}</p>
                    <small>ğŸ“… ${o.date}</small>
                </div>`;
            });
        });
    }
</script>
</body>
</html>
